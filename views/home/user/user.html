<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/home/style.css">
    <link rel="stylesheet" href="./user.css">
    <title>حسابي</title>
</head>
<body>
    <div id="header"></div>
<h2 class="title">حسابي</h2>
    <div class="row">
        <div class="col-4">
          <div class="list-group" id="list-tab" role="tablist">
            <a class="list-group-item list-group-item-action active" id="list-home-list" data-toggle="list" href="#list-home" role="tab" aria-controls="home">الملف الشخصي</a>
            <a class="list-group-item list-group-item-action" id="list-profile-list" data-toggle="list" href="#list-profile" role="tab" aria-controls="profile">كورساتي</a>
            <a class="list-group-item list-group-item-action" id="list-messages-list" data-toggle="list" href="#list-messages" role="tab" aria-controls="messages">نتائج الامتحانات
            </a>
            <a class="list-group-item list-group-item-action" id="list-settings-list" data-toggle="list" href="#list-settings" role="tab" aria-controls="settings">Settings</a>
          </div>
        </div>
        <div class="col-8">
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">

             <div class="data" id="data"></div>
        
            </div>

            <div class="tab-pane fade" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list">
            <div class="data-courses">

            </div>
            </div>

            <div class="tab-pane fade" id="list-messages" role="tabpanel" aria-labelledby="list-messages-list">
              <div class="data-studentResult">

              </div>

            </div>

            <div class="tab-pane fade" id="list-settings" role="tabpanel" aria-labelledby="list-settings-list">

            </div>
          </div>
        </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>   
       <div id="footer"></div>
    <script src="/header/header.js"></script>
    <script>
       
       let profileData = document.getElementById('data'); 
let coursesContainer = document.querySelector('.data-courses'); 
let studentResult = document.querySelector(".data-studentResult")

  const token = localStorage.getItem("token")
  console.log(token)
  if(token==null) {
    window.location.href = "/login/index.html";

  }
fetch("/user", {
  method: "GET",
  headers: {
    "Authorization": "Bearer " + localStorage.getItem("token"),
    "Content-Type": "application/json"
  }
})
  .then(response => {
    if (!response.ok) {
      throw new Error("HTTP error " + response.status);
    }
    return response.json();
  })
  .then(data => {
    // عرض بيانات البروفايل
    profileData.innerHTML = `
      <img class="user-img img-thumbnail" src="${data.user.Image}" alt="">
      <h4 class="name">${data.user.name}</h4>
      <p class="grad">${data.user.grad} الثانوي </p>
      <div>
        <h3 class="points">الدرجات<br>${data.user.points}</h3>
        <h3 class="center-id">ID<br>${data.user.centerId}</h3>
      </div>
    `;

    // عرض الكورسات
    let courses = data.courses;
    for (let i = 0; i < courses.length; i++) {
      coursesContainer.innerHTML += `
        <a href="/home/Course.html?id=${courses[i]._id}">
          <div class="card">
         
            <div class="tilt">
              <div class="img"><img src="/${courses[i].image}" alt=""></div>
            </div>
            <div class="info">
              <h2 class="title">${courses[i].title}</h2>
              <p class="desc">${courses[i].description}</p>
              <div class="bottom">
                <div class="price">
                  <span class="new">${courses[i].price} LE</span>
                </div>
              </div>
            </div>
          </div>
        </a>
      `;
    }
   // عرض نتائج الاختبارات
let results = data.studentResult;

if (results.length > 0) {
  let table = `
    <table class="results-table">
      <thead>
        <tr>
          <th>الكورس</th>
          <th>الدرجة</th>
          <th>التاريخ</th>
        </tr>
      </thead>
      <tbody>
  `;

  results.forEach(result => {
    // جلب عنوان الكورس من data.courses
    let course = data.courses.find(c => c._id === result.courseId);
    let courseTitle = course ? course.title : "غير معروف";

    table += `
      <tr>
        <td>${courseTitle}</td>
        <td>${result.score}</td>
        <td>${new Date(result.date).toLocaleDateString("ar-EG")}</td>
      </tr>
    `;
  });

  table += `</tbody></table>`;
  studentResult.innerHTML = table;
} else {
  studentResult.innerHTML = `<p>لا توجد نتائج اختبارات بعد.</p>`;
}


  })
  .catch(error => {
    console.error("حدث خطأ أثناء جلب البيانات:", error);
  });



    </script>   
</body>
</html>